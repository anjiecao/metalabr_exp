---
title: "metalabr_exp"
author: "anjie"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(here)
library(metalabr)
library(tidyboot)
library(ggthemes)

# metadata <- get_metalab_metadata()
# metalab_data <- get_metalab_data(metadata)
# write_csv(metalab_data, here("data/metalab_data.csv"))

metalab_data <- read_csv(here("data/metalab_data.csv"))
```

# weird stuff in dataset 

## function word segmentation vs wod segmentation (behavioral)


nonoverlapping, contains more info than the original published databse

```{r}
ws <- metalab_data %>% 
  filter(dataset == "Word segmentation (behavioral)") %>% 
  distinct(long_cite) %>% 
  pull()

fws <- metalab_data %>% 
  filter(dataset == "Function word segmentation") %>% 
  distinct(long_cite) %>% 
  pull()

ws
```


```{r}

m_wsb <- colnames(metalab_data %>% 
  filter(dataset == "Word segmentation (behavioral)") %>% 
  summarise_all(funs(sum(!is.na(.)))) %>% 
  select_if(~ any(. > 0)))
  

m_fws <- colnames(metalab_data %>% 
  filter(dataset == "Function word segmentation") %>% 
  summarise_all(funs(sum(!is.na(.)))) %>% 
  select_if(~ any(. > 0)))

# elements of vector m_wsb not contained in m_fws  
m_wsb_special <- setdiff(m_wsb, m_fws)
setdiff(m_fws, m_wsb)

```

```{r}
metalab_data %>% 
  filter(dataset == "Word segmentation (behavioral)") %>% 
  select(m_wsb_special)
```

## gaze following 

```{r}
gfv = metalab_data %>% 
  filter(dataset == "Gaze following (video)")

gfl = metalab_data %>% 
  filter(dataset == "Gaze following (live)")


m_gfv <- colnames(gfv %>% 
  summarise_all(funs(sum(!is.na(.)))) %>% 
  select_if(~ any(. > 0)))
  

m_gfl <- colnames(gfl %>% 
  summarise_all(funs(sum(!is.na(.)))) %>% 
  select_if(~ any(. > 0)))

# elements of vector m_wsb not contained in m_fws  
setdiff(m_gfv, m_gfl)
setdiff(m_gfl, m_gfv)

```



## older ppl?

```{r}
metalab_data %>% 
  filter(mean_age_1 > 5000) %>% 
  select(dataset, long_cite, mean_age_1)
```


## crazy sample size? 

Imitation, vocabulary, pretend play, and socially insightful behavior were investigated in 5,206 same- and opposite-sex 2-year-old twin pairs in the United Kingdom. Individual differences in imitative ability were due to modest heritability (30%), while environmental factors shared between twins (42%) and unique to each twin (28%) also made significant contributions to the variance. Imitation correlated significantly, although modestly, with vocabulary, pretend play, and socially insightful behavior, and the strongest relationship was with vocabulary. A model that represented the covariance between the variables as being due to correlated latent genetic and environmental factors fitted the data well, with shared environmental factors influencing most of the covariance. Parents who encourage imitation may also tend to foster the development of language, pretence, and socially insightful behavior.


```{r}
metalab_data %>% 
  filter(n > 1000) %>% 
  select(dataset, long_cite, n)
```

## weird level? 

```{r}
metalab_data %>% 
  distinct()
```

```{r}
metalab_data %>% 
  distinct(object_stimulus)

metalab_data %>% 
  distinct(stimuli_type)


```


# bird eye overview of the dataset 


## tbd 
code stub for figuring out how many are filled 

```{r}
metalab_data %>% 
  group_by(dataset) %>% 
  summarise_all(funs(sum(!is.na(.)))) %>% 
  left_join(
    metalab_data %>% 
  group_by(dataset) %>% summarise(n_row = n()), 
  by = "dataset"
  ) %>% 
  #mutate_at(vars(-dataset, -unique_row), funs(. / unique_row)) # this line calculate ratio of filled columns 
  
  
```


## response mode distribution 

```{r}
metalab_data %>% 
  group_by(dataset, response_mode) %>% 
  count() %>% 
  ungroup() %>% 
  left_join(
    metalab_data %>% 
  group_by(dataset) %>% summarise(n_row = n()), 
  by = "dataset"
  ) %>% 
  mutate(proportion_response_mode = n/ n_row) %>% 
  
  ggplot(aes(x = response_mode, y = proportion_response_mode)) + 
  geom_point() + 
  facet_wrap(~dataset) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), 
        strip.text.x = element_text(size = 7)) + 
  labs(title = "Response mode")
```

## method distribution

```{r}
metalab_data %>% 
  group_by(dataset, method) %>% 
  count() %>% 
  ungroup() %>% 
  left_join(
    metalab_data %>% 
  group_by(dataset) %>% summarise(n_row = n()), 
  by = "dataset"
  ) %>% 
  mutate(proportion_method = n/ n_row) %>% 
  ggplot(aes(x = method, y = proportion_method)) + 
  geom_point() + 
  facet_wrap(~dataset) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), 
        strip.text.x = element_text(size = 7)) + 
  labs(title = "Method")
```

## dependent_measure  

```{r}
metalab_data %>% 
  group_by(dataset, dependent_measure) %>% 
  count() %>% 
  ungroup() %>% 
  left_join(
    metalab_data %>% 
  group_by(dataset) %>% summarise(n_row = n()), 
  by = "dataset"
  ) %>% 
  mutate(proportion_dm = n/ n_row) %>% 
  ggplot(aes(x = dependent_measure, y = proportion_dm)) + 
  geom_point() + 
  facet_wrap(~dataset) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), 
        strip.text.x = element_text(size = 7)) + 
  labs(title = "dependent_measure")
```

## participant_type

```{r}
metalab_data %>% 
  group_by(dataset, participant_design) %>% 
  count() %>% 
  ungroup() %>% 
  left_join(
    metalab_data %>% 
  group_by(dataset) %>% summarise(n_row = n()), 
  by = "dataset"
  ) %>% 
  mutate(proportion_pd = n/ n_row) %>% 
  ggplot(aes(x = participant_design, y = proportion_pd)) + 
  geom_point() + 
  facet_wrap(~dataset) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), 
        strip.text.x = element_text(size = 7)) + 
  labs(title = "participant_design")
```
```{r}
metalab_data %>% 
  filter(dataset == "Function word segmentation")

metalab_data %>% 
  filter(dataset == "Word segmentation")
```




# goal: 

- plot sample size for every datasets
- plot age to effect size curve for every datasets 

## sample sizes?


```{r}
metalab_n <- metalab_data %>% 
  mutate(n_2 = ifelse(is.na(n_2), 0, n_2)) %>% 
  mutate(total_infants = n_1 + n_2) %>% 
  group_by(dataset) %>% 
  summarise(n = sum(total_infants)) %>% 
  arrange(n) 

metalab_n %>% 
  ggplot(aes(reorder(dataset,-n), n)) + 
  geom_point() + 
  theme_classic() + 
  theme() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


metalab_data %>% 
  filter(is.na(n_2), participant_design == "within") 
```

## age curve


https://github.com/langcog/metalab2/blob/master/pages/reports/scratch/bayesian_ma.Rmd


there are ages

```{r}
filter(metalab_data, 
       mean_age_months < 36) %>%
  ggplot(aes(x = mean_age_months, y = d_calc, 
             weight = 1/d_var_calc)) +
  geom_point(aes(size = 1/d_var_calc),
             alpha = .3) + 
  geom_smooth(method="lm", formula = y ~ x, 
              aes(col = "Linear"), 
              se = FALSE) + 
  geom_smooth(method="lm", formula = y ~ log(x), 
              aes(col = "Log"),
              se = FALSE) + 
  geom_smooth(method="lm", formula = y ~ I(x^2),
              aes(col = "Quadratic"),
              se = FALSE) +
  facet_wrap(~ short_name) + 
  geom_hline(yintercept = 0, lty = 2, col = "black") + 
  xlab("Mean age (months)") +
  ylab("Effect size (d)") +
  scale_colour_solarized(name="Models", breaks = c("Linear", "Log",
                                                "Quadratic", "Linear and Log"),
                                     labels=c("Linear" = "Linear",
                                              "Log" = "Log",
                                              "Quadratic" = "Quadratic",
                                              "Linear and Log" = "Linear and Log")) +
  ggthemes::theme_few()
```





